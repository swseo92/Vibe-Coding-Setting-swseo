#!/bin/bash
# Git pre-commit hook
# Automatically runs Claude Code commands before commit
#
# This file is managed in templates/common/.githooks/
# Install using: ./.claude/scripts/install-hooks.sh

set -e  # Exit on error

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "Running pre-commit validation..."

# Check if Claude Code is available
if ! command -v claude &> /dev/null; then
    echo -e "${YELLOW}Warning: Claude Code CLI not found${NC}"
    echo "Skipping automated validation"
    exit 0
fi

# Run pre-commit-full validation
echo "Executing: /pre-commit-full"
if claude --print "/pre-commit-full"; then
    echo -e "${GREEN}Pre-commit validation passed${NC}"
    exit 0
else
    EXITCODE=$?
    echo -e "${RED}Pre-commit validation failed (exit code: $EXITCODE)${NC}"
    echo ""
    echo "Options:"
    echo "1. Fix the issues and try again"
    echo "2. Skip hook with: git commit --no-verify"
    echo ""
    exit $EXITCODE
fi
