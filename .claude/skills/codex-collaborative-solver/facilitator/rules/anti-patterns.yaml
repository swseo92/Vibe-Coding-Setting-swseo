# Anti-Pattern Detection Rules

# Detects debate health issues that indicate low quality

anti_patterns:
  circular_reasoning:
    description: "Same argument repeated without new evidence"
    detection:
      - type: "semantic_similarity"
        threshold: 0.85  # If argument similarity >85% to previous
        window: 2        # Check last 2 rounds
    action:
      - flag: true
      - escalate_to_ai: true
      - prompt: "Circular reasoning detected. Claude and Codex are repeating argument about {topic}. Should we pivot to {suggested_alternative}?"

  premature_convergence:
    description: "Agreement reached too quickly without exploring alternatives"
    detection:
      - type: "consensus_timing"
        max_rounds: 2    # If consensus in ≤2 rounds
        min_alternatives: 2  # Without discussing ≥2 alternatives
    action:
      - flag: true
      - escalate_to_ai: true
      - prompt: "Quick consensus reached. Have we explored enough alternatives? Consider: {unexplored_options}"

  information_starvation:
    description: "Agents making guesses instead of asking user for clarification"
    detection:
      - type: "assumption_frequency"
        threshold: 3     # If ≥3 assumptions in single round
      - type: "hedging_language"
        patterns: ["probably", "might be", "could be", "perhaps", "assuming"]
        threshold: 5     # If ≥5 hedging words in round
    action:
      - flag: true
      - immediate_abort: true  # Don't escalate to AI, just abort
      - prompt: "Too many assumptions detected. Need clarification on: {missing_facts}"

  dominance:
    description: "One agent's view accepted without challenge"
    detection:
      - type: "agreement_imbalance"
        threshold: 0.8   # If one agent agrees >80% without counterpoints
        window: 2        # Check last 2 rounds
    action:
      - flag: true
      - escalate_to_ai: false  # Handle automatically
      - prompt_underdog: "Codex/Claude, you've agreed with most points. Do you see any potential issues or alternatives we should consider?"

  empty_rebuttals:
    description: "Rebuttals that add no new information"
    detection:
      - type: "content_novelty"
        threshold: 0.2   # If <20% new content vs previous
    action:
      - flag: true
      - escalate_to_ai: true
      - prompt: "Rebuttal seems empty. Either accept the point or provide substantive counter-evidence."

  scope_creep:
    description: "Debate drifting away from original problem"
    detection:
      - type: "topic_drift"
        threshold: 0.3   # If semantic similarity to original problem <30%
    action:
      - flag: true
      - escalate_to_ai: true
      - prompt: "Discussion drifting from original problem: {original}. Should we refocus or is this tangent valuable?"

# High-friction patterns (escalate immediately)
high_friction:
  rapid_turn:
    description: "Very short rounds indicating shallow exploration"
    detection:
      - type: "round_length"
        min_words: 50    # If round <50 words
        consecutive: 2   # For 2 consecutive rounds
    action:
      - escalate_to_user: true
      - prompt: "Debate seems rushed. Need more time/depth?"

  high_disagreement:
    description: "Strong disagreement persisting beyond expected rounds"
    detection:
      - type: "disagreement_persistence"
        rounds: 4        # If still disagreeing after 4 rounds
    action:
      - escalate_to_user: true
      - prompt: "Fundamental disagreement persists. This may reflect different priorities. User decision needed."

  policy_trigger:
    description: "Discussion involves policy/ethical considerations"
    keywords: ["ethics", "legal", "policy", "regulation", "moral"]
    action:
      - escalate_to_user: true
      - prompt: "Policy/ethical considerations detected. Human judgment required."

# Escalation thresholds
escalation:
  ai_facilitator:
    max_interventions_per_debate: 5  # AI can intervene up to 5 times
    cooldown_rounds: 1               # Wait 1 round between interventions

  user:
    conditions:
      - pattern: "high_friction"
      - pattern: "information_starvation"  # Only when abort needed
      - ai_interventions_exhausted: true
      - round_limit_exceeded: 7
      - facilitator_prompts_ignored: 2
